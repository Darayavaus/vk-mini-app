{"version":3,"sources":["panels/Modal.js","panels/Home.js","App.js","index.js"],"names":["Modal","props","state","modalHistory","modalBack","setActiveModal","length","console","log","onClose","activeModal","this","indexOf","splice","push","setState","id","header","left","IS_PLATFORM_ANDROID","onClick","right","IS_PLATFORM_IOS","title","group_id","photos","style","color","React","Component","Home","location","events","fetchedUser","token","useState","currentEvent","setCurrentEvent","handleEventClick","payload","v","access_token","fetch","method","body","JSON","stringify","then","data","catch","error","getGroupMembers","listEvents","map","e","idx","key","geometry","coords","className","defaultState","center","parseFloat","zoom","options","preset","App","activePanel","setUser","setLocation","size","popout","setPopout","setEvents","setToken","useEffect","a","connect","sendPromise","user","subscribe","detail","type","schemeAttribute","document","createAttribute","value","scheme","attributes","setNamedItem","fetchData","available","lat","long","send","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.22754bd7.chunk.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport {\n  UsersStack,\n  ModalRoot,\n  ModalPage,\n  ModalPageHeader,\n  HeaderButton,\n  List,\n  Cell,\n  InfoRow,\n  IS_PLATFORM_ANDROID,\n  IS_PLATFORM_IOS\n} from '@vkontakte/vkui';\n\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\nimport Icon24Dismiss from '@vkontakte/icons/dist/24/dismiss';\n\nclass Modal extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      // activeModal: null,\n      modalHistory: []\n    };\n    this.modalBack = () => {\n      this.setActiveModal(this.state.modalHistory[this.state.modalHistory.length - 2]);\n      console.log('closing!')\n      this.props.onClose()\n    };\n  }\n\n  setActiveModal(activeModal) {\n    activeModal = activeModal || null;\n    let modalHistory = this.state.modalHistory ? [...this.state.modalHistory] : [];\n\n    if (activeModal === null) {\n      modalHistory = [];\n    } else if (modalHistory.indexOf(activeModal) !== -1) {\n      modalHistory = modalHistory.splice(0, modalHistory.indexOf(activeModal) + 1);\n    } else {\n      modalHistory.push(activeModal);\n    }\n\n    this.setState({\n      activeModal,\n      modalHistory\n    });\n  };\n\n  render() {\n    return (\n      <ModalRoot\n        id='modal-1'\n        activeModal={this.props.activeModal}\n      >\n        <ModalPage\n          id='modal-page-1'\n          header={\n            <ModalPageHeader\n              left={IS_PLATFORM_ANDROID && <HeaderButton onClick={this.modalBack}><Icon24Cancel /></HeaderButton>}\n              right={IS_PLATFORM_IOS && <HeaderButton onClick={this.modalBack}><Icon24Dismiss /></HeaderButton>}\n            >\n              {this.props.title}\n            </ModalPageHeader>\n          }\n          onClose={this.modalBack}\n        >\n        <List>\n          <Cell>\n            <InfoRow title=\"Когда?\">\n              12 января 13:42\n            </InfoRow>\n          </Cell>\n          <Cell>\n            <InfoRow title=\"Чат группы\">\n              { this.props.group_id }\n            </InfoRow>\n          </Cell>\n          <UsersStack\n            photos={[\n              'https://sun9-19.userapi.com/c851232/v851232757/fb949/4rDdDHqGglQ.jpg?ava=1',\n              'https://sun9-3.userapi.com/c851536/v851536176/a9b1d/xdPOltpVQRI.jpg?ava=1',\n              'https://sun9-21.userapi.com/c851416/v851416327/be840/bnUHAblZoBY.jpg?ava=1'\n            ]}\n            style={{ color: \"#fff\" }}\n          >\n            Эти товарищи тоже идут!\n          </UsersStack>\n        </List>\n      </ModalPage>\n    </ModalRoot>\n    );\n  }\n}\n\nModal.propTypes = {\n  title: PropTypes.string,\n  group_id: PropTypes.string\n};\n\nexport default Modal;\n","import React, { useState, useEffect } from 'react';\nimport connect from '@vkontakte/vk-connect';\nimport PropTypes from 'prop-types';\n\nimport {\n  YMaps,\n  Map,\n  Placemark\n} from 'react-yandex-maps';\n\nimport Modal from './Modal';\n\nimport './Home.css';\n\nconst Home = ({ id, location, fetchedUser, events, token }) => {\n\n  const [currentEvent, setCurrentEvent] = useState(\n    {\n      title: null,\n      group_id: null,\n      activeModal: null\n    }\n  );\n\n\n  const joinGroup = (group_id) => {\n    connect\n      .sendPromise(\"VKWebAppJoinGroup\", {\"group_id\": parseInt(group_id)})\n      .then(data => {\n        console.log('data', data)\n      })\n      .catch(error => {\n        console.log('error', error)\n      });\n  }\n\n\n  const getGroupMembers = (group_id) => {\n    let endpoint = 'https://api.vk.com/method/groups.getMembers'\n    let payload = {\n      v: '5.101',\n      access_token: token,\n      group_id: group_id\n    }\n    fetch(endpoint, {method:'POST', body:JSON.stringify(payload)})\n      .then(data => {\n        console.log('data', data)\n      })\n      .catch(error => {\n        console.log('error', error)\n      });\n  }\n\n  const handleEventClick = (title, group_id) => {\n    // joinGroup(group_id)\n    getGroupMembers(group_id)\n    console.log('clicked')\n    setCurrentEvent(\n      {\n        title: title,\n        group_id: group_id,\n        activeModal: 'modal-page-1'\n      }\n    )\n    console.log(currentEvent)\n  }\n\n  const listEvents = events.map((e, idx) =>\n    <Placemark\n      key={'event-' + idx}\n      geometry={e.coords}\n      onClick={() => handleEventClick(e.title, e.group_id)}\n    />\n  );\n\n  const onCloseModale = () => {\n    setCurrentEvent(\n      {\n        title: null,\n        group_id: null,\n        activeModal: null\n      }\n    )\n  }\n\n  return (\n    <div id={id} className=\"main\">\n      <YMaps>\n        <Map className=\"map\"\n          defaultState={\n            {center: [\n              parseFloat(location[0]),\n              parseFloat(location[1])\n            ],\n            zoom: 9}\n          }\n        >\n          <Placemark\n            geometry={[parseFloat(location[0]), parseFloat(location[1])]}\n            options={{preset: 'islands#redCircleDotIcon'}}\n          />\n          {listEvents}\n\n        </Map>\n      </YMaps>\n      <Modal\n        title={currentEvent.title}\n        group_id={currentEvent.group_id}\n        activeModal={currentEvent.activeModal}\n        onClose={onCloseModale}\n      />\n    </div>\n  );\n}\n\nHome.propTypes = {\n  id: PropTypes.string.isRequired,\n  location: PropTypes.array.isRequired,\n  fetchedUser: PropTypes.shape({\n    photo_200: PropTypes.string,\n    first_name: PropTypes.string,\n    last_name: PropTypes.string,\n    city: PropTypes.shape({\n      title: PropTypes.string,\n    }),\n  }),\n};\n\nexport default Home;\n","import React, { useState, useEffect } from 'react';\nimport connect from '@vkontakte/vk-connect';\nimport View from '@vkontakte/vkui/dist/components/View/View';\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\nimport '@vkontakte/vkui/dist/vkui.css';\n\nimport Home from './panels/Home';\n\nconst App = () => {\n  const [activePanel, setActivePanel] = useState('home');\n  const [fetchedUser, setUser] = useState(null);\n  const [location, setLocation] = useState([55.798, 49.106]);\n  const [popout, setPopout] = useState(<ScreenSpinner size='large' />);\n  const [events, setEvents] = useState([]);\n  const [token, setToken] = useState('');\n  \n  const fetchLocation = () => {\n    console.log(location)\n    connect\n      .sendPromise('VKWebAppGetGeodata')\n      .then(data => {\n        if (data.available == 1) {\n          console.log('accessed user location!')\n          setLocation([data.lat, data.long])\n        }\n        console.log('location', location)\n      })\n      .catch(error => {\n        console.log('error', error)\n      });\n  }\n\n  const getToken = () => {\n    connect\n      .sendPromise(\"VKWebAppGetAuthToken\",\n        {\n          \"app_id\": 7149958,\n          \"scope\": \"friends,groups\"\n        }\n      )\n      .then(data=> {\n        console.log(data)\n        if (\"error_data\" in data) {\n          console.log('could not fetch token :(')\n        } else {\n          setToken(data.access_token)\n          console.log('fetched token', token)\n        }\n      })\n      .catch(error => {\n        console.log('error', error)\n      })\n  }\n\n  useEffect(() => {\n    connect.subscribe(({ detail: { type, data }}) => {\n      if (type === 'VKWebAppUpdateConfig') {\n        const schemeAttribute = document.createAttribute('scheme');\n        schemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n        document.body.attributes.setNamedItem(schemeAttribute);\n      }\n    });\n    setPopout(null);\n    async function fetchData() {\n      const user = await connect.sendPromise('VKWebAppGetUserInfo');\n      setUser(user);\n      setPopout(null);\n    }\n    fetchData();\n    fetchLocation();\n    getToken();\n\n    setEvents([\n      {\n        'coords': [55.766059, 49.1308083],\n        'title': 'Помочь зооботсаду',\n        'organizer': 'Казанский зооботанический сад',\n        'start': '2019-10-05 09:00',\n        'end': '2019-10-05 13:00',\n        'aim': 'Содействие в поддержании благополучия экспонируемых животных',\n        'description': 'Необходима помощь во время сезонных работ, помощь посетителям в ориентировании на территории, консультирование',\n        'requirements': ['Хорошо знать территорию зооботсада', 'Готовность выполнять любую из перечисленных задач'],\n        'icon_type': 'islands#blueZooIcon',\n        'reward': 'Бесплатное посещение экскурсий, а также памятные сувениры',\n        'photo': 'botsad.svg',\n        'group_id': '187013907',\n        'count_cur': 34,\n        'count_end': 50\n      },\n      {\n        'coords': [55.821002, 49.1586594],\n        'title': 'Помочь с техникой',\n        'organizer': 'Казань Арена',\n        'start': '2019-10-06 10:00',\n        'end': '2019-10-06 16:00',\n        'aim': 'Успешное проведение спортивного мероприятия',\n        'description': 'Необходима помощь волонтеров в организации обеспечения коммуникаций и телерадиовещания',\n        'requirements': ['Возраст от 18 лет', 'Опыт волонтерской работы на спортивных мероприятиях'],\n        'icon_type': 'islands#blueRunIcon',\n        'reward': 'Бесплатное посещение матча',\n        'photo': 'kazan-arena.svg',\n        'group_id': '187023316',\n        'count_cur': 27,\n        'count_end': 100\n      },\n      {\n        'coords': [55.6122512, 49.2959574],\n        'title': 'Прибрать за собой',\n        'organizer': 'Цифровой Прорыв',\n        'start': '2019-09-29 16:00',\n        'end': '2019-09-29 21:00',\n        'aim': 'Помочь и отбрагодарить организаторов хакатона',\n        'description': 'Требуется провести уборку на своем рабочем месте после завершения хакатона',\n        'requirements': ['Умение работать в команде'],\n        'icon_type': 'islands#blueStarIcon',\n        'reward': 'Благодарность',\n        'photo': 'cp.svg',\n        'group_id': 'None',\n        'count_cur': 3250,\n        'count_end': 3300\n      },\n      {\n        'coords': [55.7895988, 49.1014364],\n        'title': 'Отпраздновать победу',\n        'organizer': 'Фонд побед',\n        'start': '2019-09-29 21:00',\n        'end': '2019-09-29 23:00',\n        'aim': 'Весело провести время',\n        'description': 'Необходимо отдохнуть и поздравить победителей',\n        'requirements': ['Умение работать в команде'],\n        'icon_type': 'islands#blueFoodIcon',\n        'reward': 'Вы перестанете чувствовать усталость',\n        'photo': 'bar.svg',\n        'group_id': 'None',\n        'count_cur': 3,\n        'count_end': 100\n      }\n    ]);\n\n  }, []);\n\n  return (\n    <View activePanel={activePanel} popout={popout}>\n      <Home id='home' \n            location={location} \n            fetchedUser={fetchedUser} \n            events={events}\n            token={token}/>\n    </View>\n  );\n}\n\nexport default App;\n","import 'core-js/features/map';\nimport 'core-js/features/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vk-connect';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK  Mini App\nconnect.send('VKWebAppInit');\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}